tinymce.PluginManager.add("smileys",function(c,k){function h(){var e;return e='<table role="presentation" class="mce-grid">',tinymce.each(a,function(f){e+="<tr>";tinymce.each(f,function(i){e+='<td><a href="#" data-mce-url="'+i.url+'" tabindex="-1" title="'+i.title+'"><img src="'+i.url+'" style="width: 24px; height: 24px"></a></td>'});e+="</tr>"}),e+="</table>"}function b(m){var f=tinymce.each,e=[];return f(m,function(i){e=e.concat(i)}),e.length>0?e:m}function j(z,L,B,m,K){function G(p,f){var e,o;return f=f||0,e=p.index,f>0&&(o=p[f],e+=p[0].indexOf(o),p[0]=o),[e,e+p[0].length,[p[0]]]}function J(f){var e;if(f.nodeType===3){return f.data}if(C[f.nodeName]&&!D[f.nodeName]){return""}if(e="",(D[f.nodeName]||F[f.nodeName])&&(e+="\n"),f=f.firstChild){do{e+=J(f)}while(f=f.nextSibling)}return e}function q(w,U,O){var p,V,S,N,R=[],T=0,f=w,P=U.shift(),Q=0;w:for(;;){if((D[f.nodeName]||F[f.nodeName])&&T++,f.nodeType===3&&(!V&&f.length+T>=P[1]?(V=f,N=P[1]-T):p&&R.push(f),!p&&f.length+T>P[0]&&(p=f,S=P[0]-T),T+=f.length),p&&V){if(f=O({startNode:p,startNodeIndex:S,endNode:V,endNodeIndex:N,innerNodes:R,match:P[2],matchIndex:Q}),T-=V.length-N,p=null,V=null,R=[],P=U.shift(),Q++,!P){break}}else{if((!C[f.nodeName]||D[f.nodeName])&&f.firstChild){f=f.firstChild;continue}else{if(f.nextSibling){f=f.nextSibling;continue}}}for(;;){if(f.nextSibling){f=f.nextSibling;break}else{if(f.parentNode!==w){f=f.parentNode}else{break w}}}}}function I(o){var f,e;return typeof o!="function"?(e=o.nodeType?o:x.createElement(o),f=function(){return e.cloneNode(!1)}):f=o,function(P){var N,O,y,w=P.startNode,v=P.endNode,t,p;if(w===v){return t=w,y=t.parentNode,P.startNodeIndex>0&&(N=x.createTextNode(t.data.substring(0,P.startNodeIndex)),y.insertBefore(N,t)),p=f(),y.insertBefore(p,t),P.endNodeIndex<t.length&&(O=x.createTextNode(t.data.substring(P.endNodeIndex)),y.insertBefore(O,t)),t.parentNode.removeChild(t),p}}}var A,E=[],M,H=0,x,D,C,F;if(x=L.ownerDocument,D=K.getBlockElements(),C=K.getWhiteSpaceElements(),F=K.getShortEndedElements(),M=J(L),M){while(A=z.exec(M)){E.push(G(A,m))}return E.length&&(H=E.length,q(L,E,I(B))),H}}function l(n){var q=tinymce.each,o=c.selection.getNode(),m,p;if(typeof n.shortcut=="string"){return p=n.shortcut.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),m=c.dom.create("img",{src:n.url,title:n.title}),j(new RegExp(p,"gi"),o,m,!1,c.schema)}Array.isArray(n.shortcut)&&q(n.shortcut,function(e){return m=c.dom.create("img",{src:n.url,title:n.title}),j(new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gi"),o,m,!1,c.schema)})}var g=[[{shortcut:":angry",url:"/images/smileys/angry.png",title:"angry"},{shortcut:"(^^^)",url:k+"/img/shark.gif",title:"shark"},{shortcut:"O:)",url:k+"/img/angel.png",title:"angel"},{shortcut:"o.O",url:k+"/img/confused.png",title:"confused"},{shortcut:"3:)",url:k+"/img/devil.png",title:"devil"},{shortcut:":-O",url:k+"/img/gasp.png",title:"gasp"},{shortcut:"8-)",url:k+"/img/glasses.png",title:"glasses"},{shortcut:":-D",url:k+"/img/grin.png",title:"grin"}],[{shortcut:":-)",url:k+"/img/smile.png",title:"smile"},{shortcut:":'(",url:k+"/img/cry.png",title:"cry"},{shortcut:"<3",url:k+"/img/heart.png",title:"heart"},{shortcut:"^_^",url:k+"/img/kiki.png",title:"kiki"},{shortcut:":-*",url:k+"/img/kiss.png",title:"kiss"},{shortcut:":v",url:k+"/img/pacman.png",title:"pacman"},{shortcut:"<(ï¿½)",url:k+"/img/penguin.gif",title:"penguin"}],[{shortcut:":|]",url:k+"/img/robot.gif",title:"robot"},{shortcut:"-_-",url:k+"/img/squint.png",title:"squint"},{shortcut:"8-|",url:k+"/img/sunglasses.png",title:"sunglasses"},{shortcut:":-P",url:k+"/img/tongue.png",title:"tongue"},{shortcut:":/",url:k+"/img/unsure.png",title:"unsure"},{shortcut:">:O",url:k+"/img/upset.png",title:"upset"},{shortcut:">:(",url:k+"/img/grumpy.png",title:"grumpy"}]],d=c.settings.smileys||g,a=c.settings.extended_smileys?d.concat(c.settings.extended_smileys):d;c.on("keyup",function(){if(!!c.settings.auto_convert_smileys){var m=tinymce.each,f=c.selection,e=f.getNode();e&&m(b(a),function(i){l(i)})}});c.addButton("smileys",{type:"panelbutton",icon:"emoticons",panel:{autohide:!0,html:h,onclick:function(f){var e=c.dom.getParent(f.target,"a");e&&(c.insertContent('<img src="'+e.getAttribute("data-mce-url")+'" title="'+e.getAttribute("title")+'" />'),this.hide())}},tooltip:"Smileys"})});